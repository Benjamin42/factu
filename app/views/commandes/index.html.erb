<%= render :template => 'commons/_header' %>

<h3>Listing commandes</h3>

<% if Tarif.existTarifCurrentYear %>
	<div class="center">
		<%= link_to 'Nouvelle Commande', new_commande_path, class:"btn btn-primary" %>
	ou
		<button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#uploadFile">
			Chargement par fichier
		</button>
	
		<div id="uploadFile" class="collapse">
			<br />
			<%= form_tag({:action => :uploadFile}, :multipart => true) do %>
			<%= file_field_tag :my_file %>
			<%= submit_tag("Charger", class: "btn btn-primary") %>
			<% end %>
		</div>	
	</div>
<% end %>

<br />

<table class="table" id="commandes">
	<thead>
	  <tr>
	    <th>Num factu</th>
	    <th>Client</th>
	    <th>Date Factu</th>
	    <th>Date Livraison</th>
	    <th>Date Paiement</th>
	    <th>Qty Totale</th>
	    <th></th>
	    <th></th>
	    <th></th>
	    <th></th>
	  </tr>
  	</thead>
	<tbody>
		<% @commandes.each do |commande| %>
		  <tr>
		    <td><%= commande.num_factu %></td>
		    <td><%= if commande.client != nil then commande.client.nom else "" end %></td>
		    <td><%= if commande.date_factu != nil then commande.date_factu.strftime('%d/%m/%Y') else "" end %></td>
		    <td><%= if commande.date_livraison != nil then commande.date_livraison.strftime('%d/%m/%Y') else "" end %></td>
		    <td><%= if commande.date_paiement != nil then commande.date_paiement.strftime('%d/%m/%Y') else "" end %></td>
		    <td><%= commande.qtyTotal %></td>
		    <td><%= link_to 'Facture', "commandes/facturation/#{commande.id}", class:"btn btn-inverse" %></td>
		    <td><%= link_to 'Show', commande, class:"btn btn-info" %></td>
		    <td>
		    	<% if !commande.is_freeze %>
		    		<%= link_to 'Edit', edit_commande_path(commande), class:"btn btn-warning" %>
				<% else %>
					<%= link_to 'DÃ©freezer', "commandes/defreeze/#{ commande.id }", class:"btn btn-danger" %>
				<% end %>
			</td>
		    <td><%= link_to 'Destroy', commande, confirm: 'Are you sure?', method: :delete, class:"btn btn-danger" %></td>
		  </tr>
		<% end %>
	</tbody>
</table>




